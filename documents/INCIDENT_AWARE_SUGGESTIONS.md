# 🎯 事件响应智能建议系统

## ✨ 核心特性

### 1. **事件类型自动识别**
AI会自动分析当前的安全事件类型，无需手动配置场景。

### 2. **上下文感知**
- ✅ 工具执行结果
- ✅ 关键安全实体（IP、域名、CVE、哈希）
- ✅ 完整的AI分析内容

### 3. **结构化输出**
- 事件类型标签
- 优先级标识（🔥高 / ⚡中 / 💡低）
- 建议理由（鼠标悬停查看）

---

## 🔍 支持的事件类型

AI会自动识别并针对性处理：

### 1. 恶意IP分析
```
识别关键词: IP + 威胁/恶意/扫描/攻击
响应流程: 威胁确认 → 影响评估 → 封禁防护
```

### 2. 恶意软件感染
```
识别关键词: 病毒/木马/勒索/webshell/恶意软件
响应流程: 立即隔离 → 样本分析 → 清除恢复 → 加固防护
```

### 3. 可疑登录
```
识别关键词: 登录/认证/暴力破解/异常访问
响应流程: 确认真伪 → 分析意图 → 关联分析 → 持续监控
```

### 4. 漏洞相关
```
识别关键词: 漏洞/CVE/补丁/修复
响应流程: 评估影响 → 查找补丁 → 临时缓解 → 修复验证
```

### 5. 数据泄露
```
识别关键词: 泄露/敏感数据/数据外传
响应流程: 确认范围 → 阻断传输 → 取证分析 → 影响评估
```

### 6. 内部威胁
```
识别关键词: 内部/员工/账号异常/权限滥用
响应流程: 身份确认 → 行为分析 → 证据收集 → 应对措施
```

---

## 📊 效果示例

### 示例1：恶意IP分析

**用户输入**：
```
查询109.172.85.63的威胁情报
```

**AI分析**：
```
该IP被标记为高风险恶意IP，来自俄罗斯，
与APT28组织相关，近期进行了大规模扫描活动...
```

**智能建议**：
```
┌─ 💡 建议的下一步行动 ───────── ︿ ────┐
│ 📋 高危恶意IP威胁分析                 │
├───────────────────────────────────────┤
│ 🔥 1  在防火墙立即封禁该IP        ℹ️ →│
│      (理由: 该IP正在进行主动攻击)     │
│ 🔥 2  检查内网是否有连接记录      ℹ️ →│
│      (理由: 确认是否已有主机被入侵)   │
│ ⚡ 3  查询该IP的历史攻击记录      ℹ️ →│
│      (理由: 了解攻击者的行为模式)     │
└───────────────────────────────────────┘
```

---

### 示例2：勒索软件感染

**用户输入**：
```
服务器发现勒索软件，如何处理？
```

**AI分析**：
```
勒索软件感染属于严重安全事件，需要立即应急响应...
```

**智能建议**：
```
┌─ 💡 建议的下一步行动 ───────── ︿ ────┐
│ 📋 勒索软件应急响应                   │
├───────────────────────────────────────┤
│ 🔥 1  立即隔离受感染服务器        ℹ️ →│
│      (理由: 防止感染扩散到其他主机)   │
│ 🔥 2  确认备份系统是否可用        ℹ️ →│
│      (理由: 评估数据恢复可能性)       │
│ ⚡ 3  提取样本进行深度分析        ℹ️ →│
│      (理由: 识别勒索软件类型和解密方案)│
└───────────────────────────────────────┘
```

---

### 示例3：可疑登录

**用户输入**：
```
检测到异常登录行为，来自陌生IP
```

**AI分析**：
```
检测到账号异常登录，登录IP与用户常用地点不符...
```

**智能建议**：
```
┌─ 💡 建议的下一步行动 ───────── ︿ ────┐
│ 📋 可疑登录事件调查                   │
├───────────────────────────────────────┤
│ 🔥 1  立即冻结该账号并通知用户    ℹ️ →│
│      (理由: 防止账号被进一步滥用)     │
│ ⚡ 2  查询该IP的地理位置和历史  ℹ️ →│
│      (理由: 确认是否为恶意登录)       │
│ ⚡ 3  检查该账号的最近操作日志    ℹ️ →│
│      (理由: 评估潜在的数据泄露风险)   │
└───────────────────────────────────────┘
```

---

### 示例4：高危漏洞

**用户输入**：
```
CVE-2024-1234这个漏洞影响我们吗？
```

**AI分析**：
```
CVE-2024-1234是Apache高危远程代码执行漏洞...
```

**智能建议**：
```
┌─ 💡 建议的下一步行动 ───────── ︿ ────┐
│ 📋 高危漏洞应急响应                   │
├───────────────────────────────────────┤
│ 🔥 1  确认受影响的资产清单        ℹ️ →│
│      (理由: 评估影响范围优先保护关键系统)│
│ 🔥 2  查找官方补丁和缓解措施      ℹ️ →│
│      (理由: 及时修复漏洞防止被利用)   │
│ ⚡ 3  检查日志是否有利用尝试      ℹ️ →│
│      (理由: 判断是否已被攻击)         │
└───────────────────────────────────────┘
```

---

## 🎯 优势对比

### ❌ 优化前

```
建议：
  1. 查询历史记录
  2. 检查网络流量
  3. 分析可疑活动

问题：
  - 通用化，缺乏针对性
  - 没有优先级
  - 不知道为什么要这么做
  - 不符合事件响应流程
```

### ✅ 优化后

```
📋 恶意IP威胁分析

建议：
  🔥 1  在防火墙立即封禁该IP  (理由: 正在主动攻击)
  🔥 2  检查内网连接记录      (理由: 确认是否被入侵)
  ⚡ 3  查询历史攻击记录      (理由: 了解攻击模式)

优势：
  ✅ 自动识别事件类型
  ✅ 优先级明确（高危优先）
  ✅ 提供执行理由
  ✅ 符合应急响应流程
  ✅ 结合上下文（工具结果、实体信息）
```

---

## 🔧 技术实现

### 1. 上下文收集
```javascript
buildSuggestionContext(aiResponse, userQuery) {
  // 收集：
  - 用户问题
  - AI完整分析（1000字）
  - 工具执行结果（最近8条）
  - 关键实体（IP、域名、CVE、哈希）
}
```

### 2. AI分析
```javascript
Prompt:
- 分析事件类型
- 应用事件响应原则
- 按紧急程度排序
- 提供执行理由

输出:
{
  "incident_type": "恶意IP威胁分析",
  "suggestions": [
    {
      "action": "在防火墙立即封禁该IP",
      "priority": "high",
      "reason": "该IP正在进行主动攻击"
    }
  ]
}
```

### 3. 智能显示
```javascript
- 事件类型标签（📋）
- 优先级图标（🔥⚡💡）
- 理由提示（ℹ️ hover）
- 点击填充到输入框
```

---

## 📋 事件响应流程映射

AI的建议会自动遵循标准事件响应流程：

```
1. 检测 (Detection)
   - 确认事件真实性
   - 识别威胁类型
   
2. 分析 (Analysis)
   - 评估影响范围
   - 追踪攻击来源
   
3. 遏制 (Containment)
   - 隔离受影响系统
   - 阻断攻击路径
   
4. 根除 (Eradication)
   - 清除恶意代码
   - 修复漏洞
   
5. 恢复 (Recovery)
   - 恢复系统功能
   - 验证安全性
   
6. 总结 (Lessons Learned)
   - 事后分析
   - 改进措施
```

AI会根据当前所处的阶段，给出最合适的下一步建议。

---

## 🧪 测试场景

### 测试1：恶意IP
```
输入: 109.172.85.63是恶意IP吗
预期: 识别为"恶意IP分析"，给出封禁、溯源等建议
```

### 测试2：勒索软件
```
输入: 服务器感染了勒索软件
预期: 识别为"勒索软件应急"，给出隔离、备份等建议
```

### 测试3：漏洞
```
输入: CVE-2024-1234的影响
预期: 识别为"漏洞响应"，给出评估、修复等建议
```

### 测试4：可疑登录
```
输入: 检测到异常登录
预期: 识别为"可疑登录调查"，给出确认、分析等建议
```

### 测试5：数据泄露
```
输入: 发现数据外传
预期: 识别为"数据泄露事件"，给出阻断、溯源等建议
```

---

## 💡 使用技巧

### 1. 提供更多上下文
```
✅ 好：检测到109.172.85.63在扫描22端口，已触发IDS告警
❌ 差：这个IP怎么样
```

### 2. 使用工具增强上下文
```
✅ 先调用威胁情报工具，再看建议
❌ 不用工具直接问
```

### 3. 查看建议理由
```
鼠标悬停在 ℹ️ 图标上，了解为什么需要这个行动
```

### 4. 按优先级执行
```
🔥 高优先级：立即执行（紧急处置）
⚡ 中优先级：及时执行（深入调查）
💡 低优先级：可选执行（预防措施）
```

---

## 🚀 后续可优化点

### 1. 历史建议学习
记录用户最常执行的建议，优化生成策略

### 2. 自定义事件类型
允许企业定义自己的事件分类和响应流程

### 3. 建议执行追踪
记录哪些建议被执行了，效果如何

### 4. 多语言支持
支持英文等其他语言的建议生成

### 5. 集成工作流
点击建议直接触发工单系统或SOAR平台

---

## ✅ 总结

新的智能建议系统：

- ✅ **自动识别事件类型** - 不需要手动配置场景
- ✅ **上下文感知** - 结合工具结果和实体信息
- ✅ **优先级明确** - 高危事件优先处理
- ✅ **提供理由** - 知其然也知其所以然
- ✅ **符合流程** - 遵循标准事件响应流程
- ✅ **持续学习** - AI会根据反馈不断优化

让安全分析师的工作更高效、更专业！🎯
