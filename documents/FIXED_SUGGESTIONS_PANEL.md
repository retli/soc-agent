# 🎯 固定建议面板 - 使用指南

## ✨ 新UI设计

### 设计理念

将"建议的下一步行动"从聊天记录中独立出来，**固定显示在输入框上方**，具有以下优势：

✅ **始终可见** - 不会随聊天记录滚动而消失  
✅ **快速访问** - 接近输入框，操作流畅  
✅ **节省空间** - 可折叠，不占用聊天区域  
✅ **更专业** - 类似IDE的快捷操作面板

---

## 📐 UI布局

```
┌────────────────────────────────────────┐
│  🔄 新对话    📜 历史    ⚙️ 设置     │  ← 顶部工具栏
├────────────────────────────────────────┤
│                                        │
│  👤 用户: 查询109.172.85.63的威胁情报 │
│                                        │
│  🤖 AI: 该IP被标记为高风险...         │
│                                        │  ← 聊天记录区
│                                        │    (可滚动)
│                                        │
│                                        │
└────────────────────────────────────────┘
┌─ 💡 建议的下一步行动 ────────── ︿ ───┐  ← 固定面板
│  1  查询该IP的历史告警记录         →  │    (sticky)
│  2  检查相关资产的网络流量         →  │    不随滚动
│  3  分析同时段其他可疑活动         →  │
└────────────────────────────────────────┘
┌────────────────────────────────────────┐
│ [输入消息...]                    [发送]│  ← 输入框
└────────────────────────────────────────┘
```

---

## 🎨 视觉特性

### 1. 固定定位
```css
position: sticky;
bottom: 80px;  /* 输入框高度 + 间距 */
```
- 面板固定在输入框上方
- 聊天记录滚动时面板保持可见
- 始终在视野范围内

### 2. 渐变背景
```css
background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
border-left: 4px solid #3b82f6;
```
- 柔和的蓝色渐变
- 左侧蓝色强调边框
- 清晰的视觉层次

### 3. 动画效果

**出现动画**：
```css
@keyframes slideUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
```
- 从下向上滑入
- 持续300ms
- 流畅自然

**悬停效果**：
- 建议项背景变浅蓝色
- 边框变深蓝色
- 向右平移4px
- 显示阴影

---

## 🖱️ 交互功能

### 1. 折叠/展开

**点击标题栏**即可折叠或展开建议列表

```
展开状态：
┌─ 💡 建议的下一步行动 ────────── ︿ ───┐
│  1  查询该IP的历史告警记录         →  │
│  2  检查相关资产的网络流量         →  │
│  3  分析同时段其他可疑活动         →  │
└────────────────────────────────────────┘

折叠状态：
┌─ 💡 建议的下一步行动 ────────── ﹀ ───┐
└────────────────────────────────────────┘
```

**折叠按钮**：
- 展开时：`︿` (向上箭头)
- 折叠时：`﹀` (向下箭头)
- 悬停时放大1.2倍

### 2. 点击建议

点击任意建议项：
1. ✅ 自动填充到输入框
2. ✅ 调整输入框高度
3. ✅ 聚焦输入框
4. ✅ （可选）自动发送

**视觉反馈**：
```
普通状态：
│  1  查询该IP的历史告警记录         →  │

悬停状态：
│  1  查询该IP的历史告警记录     →  │  ← 浅蓝背景 + 右移
     ^^^^^^^^^^^^^^^^^^^^^
     深蓝边框 + 阴影
```

### 3. 滚动行为

当建议超过5条时：
```
┌─ 💡 建议的下一步行动 ────────── ︿ ───┐
│  1  建议1                           →  │
│  2  建议2                           →  │  ← 可见区域
│  3  建议3                           →  │    (max 200px)
│  ┆  ┆                              ┆  │
└────────────────────────────────────────┘
   ^
   细滚动条
```

---

## 🛠️ 技术实现

### HTML结构

```html
<!-- 固定的建议行动区域 -->
<div id="suggestedActionsPanel" class="suggested-actions-panel" style="display: none;">
  <div class="suggestions-header">
    <span class="suggestions-title">💡 建议的下一步行动</span>
    <button id="toggleSuggestions" class="toggle-btn">︿</button>
  </div>
  <div id="suggestedActionsContent" class="suggestions-content">
    <!-- 建议动态填充 -->
  </div>
</div>
```

### JavaScript逻辑

```javascript
// 显示建议
displaySuggestedActions(suggestions) {
  const panel = document.getElementById('suggestedActionsPanel');
  const content = document.getElementById('suggestedActionsContent');
  
  // 清空旧内容
  content.innerHTML = '';
  
  // 创建建议项
  suggestions.forEach((suggestion, index) => {
    const item = document.createElement('div');
    item.className = 'suggestion-item';
    item.innerHTML = `
      <span class="suggestion-number">${index + 1}</span>
      <span class="suggestion-text">${suggestion}</span>
      <span class="suggestion-arrow">→</span>
    `;
    item.addEventListener('click', () => {
      this.handleSuggestionClick(suggestion);
    });
    content.appendChild(item);
  });
  
  // 显示面板
  panel.style.display = 'block';
}

// 折叠/展开
suggestionsHeader.addEventListener('click', () => {
  content.classList.toggle('collapsed');
  toggleBtn.classList.toggle('collapsed');
  toggleBtn.textContent = isCollapsed ? '︿' : '﹀';
});
```

---

## 📊 使用场景

### 场景1：IP调查

```
👤 用户: 查询109.172.85.63的威胁情报
🤖 AI: 该IP被标记为高风险，来自俄罗斯...

┌─ 💡 建议的下一步行动 ────────── ︿ ───┐
│  1  查询该IP访问的内部资产列表     →  │  ← 点击
│  2  检查防火墙是否已封禁该IP       →  │
│  3  查看近7天该IP的访问日志        →  │
└────────────────────────────────────────┘

[查询该IP访问的内部资产列表]    [发送]  ← 自动填充
```

### 场景2：恶意软件分析

```
👤 用户: 分析文件哈希 a3f5d8e2...
🤖 AI: 该文件被识别为勒索软件变种...

┌─ 💡 建议的下一步行动 ────────── ︿ ───┐
│  1  立即隔离受感染主机             →  │
│  2  检查同网段其他设备状态         →  │
│  3  确认备份系统是否可用           →  │
└────────────────────────────────────────┘
```

### 场景3：长对话

```
[聊天记录很长，需要向上滚动查看...]
  
👤 用户: (向上滚动查看历史)
🤖 AI: ...

┌─ 💡 建议的下一步行动 ────────── ︿ ───┐  ← 仍然可见！
│  1  查询相关告警                   →  │
│  2  分析攻击链路                   →  │
└────────────────────────────────────────┘
[输入消息...]                      [发送]
```

---

## ⚙️ 配置选项

### 设置页面控制

```
┌─────────────────────────────────────────┐
│ 高级功能                                 │
├─────────────────────────────────────────┤
│ AI建议行动               [✓] 开启       │
│ AI会在每次回复后，基于上下文提供1-3条  │
│ 建议的后续调查步骤，帮助扩展思路        │
├─────────────────────────────────────────┤
│ 建议自动发送             [ ] 关闭       │
│ 点击建议后自动发送（关闭时仅填充）      │
└─────────────────────────────────────────┘
```

### 代码配置

```javascript
// defaults.js
ui: {
  enableSuggestedActions: true,   // 是否启用建议功能
  autoSendSuggestions: false      // 点击后是否自动发送
}
```

---

## 🎯 优势对比

### ❌ 旧设计（在聊天记录中）

```
│  🤖 AI: 该IP被标记为高风险...         │
│                                        │
│  ┌─ 💡 建议 ─────────────────────┐    │
│  │ 1. 建议1                       │    │  ← 会被滚动隐藏
│  │ 2. 建议2                       │    │
│  └────────────────────────────────┘    │
│                                        │
│  👤 用户: 后续问题...                 │  ← 建议已看不到
│                                        │
│  🤖 AI: ...                           │
```

**问题**：
- ❌ 随聊天记录滚动消失
- ❌ 需要向上翻找建议
- ❌ 占用聊天区域空间
- ❌ 不适合长对话

### ✅ 新设计（固定面板）

```
│  🤖 AI: 该IP被标记为高风险...         │
│                                        │
│  👤 用户: 后续问题...                 │
│                                        │  ← 可以自由滚动
│  🤖 AI: ...                           │
│                                        │
└────────────────────────────────────────┘
┌─ 💡 建议的下一步行动 ────────── ︿ ───┐  ← 始终可见！
│  1  查询该IP的历史告警记录         →  │
│  2  检查相关资产的网络流量         →  │
└────────────────────────────────────────┘
```

**优势**：
- ✅ 始终在视野内
- ✅ 不占用聊天空间
- ✅ 接近输入框，操作便捷
- ✅ 可折叠，灵活控制
- ✅ 适合各种对话长度

---

## 🧪 测试步骤

### 1. 重新加载扩展
```
chrome://extensions → 刷新 AI SOC Chat 🔄
```

### 2. 发起对话
```
输入: 查询109.172.85.63的威胁情报
```

### 3. 验证UI

**应该看到**：
```
✅ 建议面板固定在输入框上方
✅ 面板有蓝色渐变背景
✅ 标题显示 💡 图标
✅ 有折叠按钮 ︿
✅ 建议项带编号和箭头
```

### 4. 测试交互

**滚动聊天记录**：
- ✅ 建议面板保持固定
- ✅ 不随内容滚动

**点击标题栏**：
- ✅ 建议列表折叠/展开
- ✅ 箭头图标切换 ︿ ⇄ ﹀

**悬停建议**：
- ✅ 背景变浅蓝
- ✅ 边框变深蓝
- ✅ 向右平移4px

**点击建议**：
- ✅ 填充到输入框
- ✅ 输入框获得焦点

### 5. Console测试

```javascript
// 快速显示测试建议
window.aiChat.testShowSuggestions()

// 应该看到固定面板出现 ✅
```

---

## 🎨 自定义样式

### 调整面板高度

```css
/* sidebar.css */
.suggestions-content {
  max-height: 200px;  /* 改为150px或250px */
}
```

### 调整固定位置

```css
.suggested-actions-panel {
  bottom: 80px;  /* 调整距离输入框的高度 */
}
```

### 修改配色

```css
/* 更换为紫色主题 */
.suggested-actions-panel {
  background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
  border-left: 4px solid #a855f7;
}

.suggestions-title {
  color: #7e22ce;
}

.suggestion-item:hover {
  background: #faf5ff;
  border-color: #a855f7;
}
```

---

## 📝 关键文件

### 修改的文件

1. **sidebar.html**
   - 添加固定面板HTML结构
   - 放置在输入框之前

2. **sidebar.css**
   - 添加固定面板样式
   - sticky定位
   - 动画效果
   - 悬停交互

3. **sidebar.js**
   - 修改`displaySuggestedActions()`
   - 添加折叠功能
   - 更新事件监听

---

## 💡 使用技巧

### 1. 快捷键操作
- 展开面板后可以用Tab键在建议间切换
- 回车键选中建议

### 2. 临时隐藏
- 点击标题栏快速折叠
- 不影响建议保存
- 需要时再展开

### 3. 长对话场景
- 建议始终可见
- 无需滚动查找
- 提高操作效率

### 4. 多轮调查
- 每次AI回复更新建议
- 旧建议自动替换
- 始终显示最新建议

---

## 🚀 未来增强

### 可能的改进

1. **快捷操作**
   - 右键建议复制
   - 拖拽建议到输入框

2. **历史记录**
   - 保存历史建议
   - 下拉查看旧建议

3. **智能排序**
   - 高优先级标记 🔥
   - 推荐度评分

4. **自定义位置**
   - 允许用户拖拽面板
   - 左侧/右侧/底部可选

---

## ✅ 总结

新的固定建议面板设计：

✨ **用户体验**：
- 始终可见，快速访问
- 不干扰聊天记录查看
- 流畅的动画和交互

🎯 **功能完善**：
- 可折叠，节省空间
- 点击填充，效率翻倍
- 完善的错误处理

🎨 **视觉优雅**：
- 专业的渐变配色
- 清晰的视觉层次
- 细腻的交互反馈

🚀 **现在就体验吧！**
