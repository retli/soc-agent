# AI SOC Chat Chrome æ‰©å±•æ–‡æ¡£

- [é¡¹ç›®ä»‹ç»](#é¡¹ç›®ä»‹ç»)
- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [å®‰è£…ä¸ä½¿ç”¨](#å®‰è£…ä¸ä½¿ç”¨)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [é…ç½®æŒ‡å—](#é…ç½®æŒ‡å—)
- [MCP æœåŠ¡](#mcp-æœåŠ¡)
- [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
- [é‡æ„è¯´æ˜](#é‡æ„è¯´æ˜)

## é¡¹ç›®ä»‹ç»

ä¸€ä¸ªä¼˜é›…çš„ Chrome æ‰©å±•ï¼Œç”¨äºé€šè¿‡ AI API è¿›è¡Œå¯¹è¯ï¼Œæ”¯æŒ MCP (Model Context Protocol) æœåŠ¡é›†æˆã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ¨ **ä¾§è¾¹æ ç•Œé¢** - æ‰©å±•æ¿€æ´»åå ç”¨æµè§ˆå™¨é¡µé¢å·¦ä¾§ï¼Œä¸é®æŒ¡å†…å®¹
- ğŸ’¬ **å¯¹è¯ç®¡ç†** - æ”¯æŒåˆ›å»ºæ–°å¯¹è¯å’ŒæŸ¥çœ‹å†å²å¯¹è¯
- ğŸ”Œ **MCP æœåŠ¡é›†æˆ** - å¯é…ç½®ç¬¬ä¸‰æ–¹ MCP æœåŠ¡ï¼ˆSSE æ ¼å¼ï¼‰
- ğŸ¨ **ç°ä»£ UI** - ç®€æ´ç¾è§‚çš„ç”¨æˆ·ç•Œé¢
- ğŸ’¾ **æœ¬åœ°å­˜å‚¨** - å¯¹è¯å†å²ä¿å­˜åœ¨æœ¬åœ°
- ğŸ› ï¸ **å¼€å‘æ¨¡å¼** - æ”¯æŒè°ƒè¯•å’Œæ—¥å¿—çº§åˆ«é…ç½®

## å®‰è£…ä¸ä½¿ç”¨

### å®‰è£…æ­¥éª¤

1. æ‰“å¼€ Chrome æµè§ˆå™¨ï¼Œè®¿é—® `chrome://extensions/`
2. å¼€å¯å³ä¸Šè§’çš„"å¼€å‘è€…æ¨¡å¼"
3. ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"
4. é€‰æ‹©æœ¬é¡¹ç›®æ–‡ä»¶å¤¹

### é…ç½® AI API

é¦–æ¬¡ä½¿ç”¨éœ€è¦é…ç½® AI APIï¼š

1. ç‚¹å‡»æ‰©å±•å›¾æ ‡æ—çš„"è®¾ç½®"æŒ‰é’®
2. å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **API åœ°å€**: API çš„åŸºç¡€åœ°å€ï¼ˆé»˜è®¤ï¼š`https://api.example.com/v1`ï¼‰
   - **API Key**: API Key
   - **ç”¨æˆ· ID**: å¯é€‰ï¼Œç”¨äºæ ‡è¯†ç”¨æˆ·
3. ç‚¹å‡»"ä¿å­˜è®¾ç½®"

### å¼€å§‹å¯¹è¯

1. ç‚¹å‡»æµè§ˆå™¨å·¥å…·æ ä¸­çš„æ‰©å±•å›¾æ ‡
2. ä¾§è¾¹æ å°†ä»å·¦ä¾§æ»‘å‡º
3. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥æ¶ˆæ¯ï¼ŒæŒ‰ Enter æˆ–ç‚¹å‡»"å‘é€"
4. ä½¿ç”¨"æ–°å¯¹è¯"æŒ‰é’®åˆ›å»ºæ–°çš„å¯¹è¯
5. ç‚¹å‡»å¯¹è¯åˆ—è¡¨åˆ‡æ¢ä¸åŒçš„å¯¹è¯å†å²

### é…ç½® MCP æœåŠ¡ï¼ˆå¯é€‰ï¼‰

MCP (Model Context Protocol) æœåŠ¡å¯ä»¥ä¸ºå¯¹è¯æä¾›é¢å¤–çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š

1. åœ¨è®¾ç½®é¡µé¢æ‰¾åˆ°"MCP æœåŠ¡é…ç½®"éƒ¨åˆ†
2. ç‚¹å‡»"+ æ·»åŠ  MCP æœåŠ¡"
3. é…ç½®æœåŠ¡ä¿¡æ¯ï¼š
   - **æœåŠ¡åç§°**: è‡ªå®šä¹‰åç§°
   - **SSE ç«¯ç‚¹ URL**: æ”¯æŒ Server-Sent Events çš„æœåŠ¡åœ°å€
   - **è¯·æ±‚æ–¹æ³•**: GET æˆ– POST
4. ä½¿ç”¨å¼€å…³å¯ç”¨/ç¦ç”¨æœåŠ¡
5. ä¿å­˜è®¾ç½®

## é¡¹ç›®ç»“æ„

```
chrome_ext/
â”œâ”€â”€ manifest.json          # æ‰©å±•é…ç½®æ–‡ä»¶
â”œâ”€â”€ background.js          # åå°æœåŠ¡è„šæœ¬
â”œâ”€â”€ content.js            # å†…å®¹è„šæœ¬ï¼ˆæ³¨å…¥ä¾§è¾¹æ ï¼‰
â”œâ”€â”€ sidebar.html          # ä¾§è¾¹æ  HTML
â”œâ”€â”€ sidebar.js            # ä¾§è¾¹æ ä¸»é€»è¾‘
â”œâ”€â”€ sidebar.css           # ä¾§è¾¹æ æ ·å¼
â”œâ”€â”€ options.html          # è®¾ç½®é¡µé¢ HTML
â”œâ”€â”€ options.js            # è®¾ç½®é¡µé¢é€»è¾‘
â”œâ”€â”€ src/                  # æºä»£ç æ¨¡å—
â”‚   â”œâ”€â”€ config/          # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ defaults.js  # é»˜è®¤é…ç½®å€¼
â”‚   â”‚   â””â”€â”€ constants.js # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ services/        # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ ai-api.js    # AI API æœåŠ¡
â”‚   â”‚   â””â”€â”€ mcp-client.js # MCP å®¢æˆ·ç«¯æœåŠ¡
â”‚   â””â”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ storage.js   # å­˜å‚¨ç®¡ç†
â”‚       â”œâ”€â”€ logger.js    # æ—¥å¿—å·¥å…·
â”‚       â”œâ”€â”€ text-formatter.js # æ–‡æœ¬æ ¼å¼åŒ–
â”‚       â””â”€â”€ tool-parser.js    # å·¥å…·è§£æå™¨
â”œâ”€â”€ icons/                # æ‰©å±•å›¾æ ‡
â”‚   â”œâ”€â”€ icon16.png
â”‚   â”œâ”€â”€ icon48.png
â”‚   â””â”€â”€ icon128.png
â””â”€â”€ DOCUMENTATION.md      # é¡¹ç›®æ–‡æ¡£
```

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Chrome Extension                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
        â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  background.jsâ”‚    â”‚   content.js  â”‚    â”‚  options.html â”‚
â”‚  (Service     â”‚    â”‚  (Injection)  â”‚    â”‚  (Settings)   â”‚
â”‚   Worker)     â”‚    â”‚               â”‚    â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                â”‚
                              â”‚                â”‚
                              â–¼                â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  sidebar.html  â”‚  â”‚   options.js   â”‚
                     â”‚  (Chat UI)     â”‚  â”‚   (Config)     â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                   â”‚
                              â–¼                   â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚         sidebar.js (Main App)      â”‚
                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                     â”‚  â”‚      Application Layer       â”‚  â”‚
                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚                                    â”‚
                     â–¼                                    â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Service Layer  â”‚              â”‚    Utils Layer      â”‚
           â”‚                 â”‚              â”‚                     â”‚
           â”‚ â€¢ AIAPIService  â”‚              â”‚ â€¢ StorageManager    â”‚
           â”‚ â€¢ MCPClient     â”‚              â”‚ â€¢ Logger            â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â€¢ TextFormatter     â”‚
                     â”‚                      â”‚ â€¢ ToolParser        â”‚
                     â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Config Layer   â”‚
           â”‚                 â”‚
           â”‚ â€¢ DEFAULT_CONFIGâ”‚
           â”‚ â€¢ CONSTANTS     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

- **Chrome Extension Manifest V3**
- **ES6 Modules** - æ¨¡å—åŒ–ä»£ç ç»„ç»‡
- **åŸç”Ÿ JavaScript** - æ— æ¡†æ¶ä¾èµ–
- **Chrome Storage API** - æœ¬åœ°æ•°æ®å­˜å‚¨
- **Fetch API** - HTTP è¯·æ±‚
- **EventSource** - SSE è¿æ¥

### åˆ†å±‚æ¶æ„

æœ¬é¡¹ç›®é‡‡ç”¨**æ¨¡å—åŒ–ã€åˆ†å±‚æ¶æ„**ï¼š

1. **é…ç½®å±‚** (`src/config/`)
   - `defaults.js` - é»˜è®¤é…ç½®å’Œå¼€å‘æ¨¡å¼è®¾ç½®
   - `constants.js` - åº”ç”¨å¸¸é‡å’Œæšä¸¾å€¼

2. **æœåŠ¡å±‚** (`src/services/`)
   - `ai-api.js` - AI API é€šä¿¡æœåŠ¡
   - `mcp-client.js` - MCP åè®®å®¢æˆ·ç«¯

3. **å·¥å…·å±‚** (`src/utils/`)
   - `storage.js` - Chrome Storage å°è£…
   - `logger.js` - å¯é…ç½®çš„æ—¥å¿—ç³»ç»Ÿ
   - `text-formatter.js` - æ–‡æœ¬æ ¼å¼åŒ–å·¥å…·
   - `tool-parser.js` - å·¥å…·è°ƒç”¨è§£æå™¨

4. **åº”ç”¨å±‚**
   - `background.js` - åå°æœåŠ¡å·¥ä½œè€…
   - `content.js` - å†…å®¹è„šæœ¬æ³¨å…¥
   - `sidebar.js` - ä¾§è¾¹æ æ ¸å¿ƒé€»è¾‘
   - `options.js` - è®¾ç½®é¡µé¢ç®¡ç†

### ä¸»è¦ç±»

#### `AIChat` (sidebar.js)
- `init()` - åˆå§‹åŒ–èŠå¤©ç³»ç»Ÿ
- `createNewConversation()` - åˆ›å»ºæ–°å¯¹è¯
- `sendMessage()` - å‘é€æ¶ˆæ¯å¹¶å¤„ç†å“åº”
- `executeToolFromIntent()` - æ‰§è¡Œå·¥å…·è°ƒç”¨
- `refreshMCPTools()` - åˆ·æ–° MCP å·¥å…·ç¼“å­˜

#### `OptionsManager` (options.js)
- `saveSettings()` - ä¿å­˜æ‰€æœ‰é…ç½®
- `testApiConnection()` - æµ‹è¯• API è¿æ¥
- `testMCPService()` - æµ‹è¯• MCP æœåŠ¡

#### `StorageManager` (src/utils/storage.js)
- `getAIConfig()` / `saveAIConfig()` - AI é…ç½®ç®¡ç†
- `getMCPServices()` / `saveMCPServices()` - MCP æœåŠ¡ç®¡ç†
- `getConversations()` / `saveConversations()` - å¯¹è¯å†å²ç®¡ç†
- `getDevMode()` / `saveDevMode()` - å¼€å‘æ¨¡å¼è®¾ç½®

#### `MCPClient` (src/services/mcp-client.js)
- `getTools()` - è·å–å¯ç”¨å·¥å…·åˆ—è¡¨
- `callTool(name, args)` - è°ƒç”¨æŒ‡å®šå·¥å…·

#### `AIAPIService` (src/services/ai-api.js)
- `sendMessage(messages, options)` - å‘é€èŠå¤©è¯·æ±‚
- `buildMessages(query, history, systemPrompt)` - æ„å»ºæ¶ˆæ¯æ•°ç»„
- `testConnection()` - æµ‹è¯• API è¿æ¥

### æ•°æ®æµ

#### ç”¨æˆ·å‘é€æ¶ˆæ¯æµç¨‹

```
ç”¨æˆ·è¾“å…¥
   â”‚
   â–¼
sidebar.js: sendMessage()
   â”‚
   â”œâ”€â–º StorageManager.getAIConfig()          # è·å–é…ç½®
   â”œâ”€â–º MCPClient.getTools()                  # è·å– MCP å·¥å…·
   â”‚
   â–¼
AIAPIService.sendMessage()                   # å‘é€åˆ° AI API
   â”‚
   â–¼
AI å“åº”
   â”‚
   â”œâ”€â–º ToolParser.detectToolIntent()         # æ£€æµ‹å·¥å…·è°ƒç”¨
   â”‚   â”‚
   â”‚   â–¼
   â”‚   (å¦‚æœæ£€æµ‹åˆ°å·¥å…·)
   â”‚   â””â”€â–º appendToolExecutionPrompt()       # æ˜¾ç¤ºç¡®è®¤ç•Œé¢
   â”‚       â”‚
   â”‚       â–¼ (ç”¨æˆ·ç¡®è®¤)
   â”‚       MCPClient.callTool()              # æ‰§è¡Œå·¥å…·
   â”‚       â”‚
   â”‚       â–¼
   â”‚       AIAPIService.sendMessage()        # æ ¼å¼åŒ–ç»“æœ
   â”‚
   â–¼
appendMessage()                              # æ˜¾ç¤ºæ¶ˆæ¯
   â”‚
   â–¼
StorageManager.saveConversations()           # ä¿å­˜å¯¹è¯
```

## é…ç½®æŒ‡å—

### é»˜è®¤é…ç½® (`src/config/defaults.js`)

åŒ…å«æ‰€æœ‰é»˜è®¤å€¼å’Œå¼€å‘æ¨¡å¼è®¾ç½®ï¼š

```javascript
DEFAULT_CONFIG = {
  api: {
    url: 'https://api.example.com/v1',
    key: '',
    model: 'Qwen1.5-14B-Chat',
    temperature: 0.7,
    maxTokenLength: 1024,
    topP: 1,
    n: 1
  },
  user: {
    idPrefix: 'user-'
  },
  mcp: {
    timeout: 30000,
    protocolVersion: '2024-01-01'
  },
  ui: {
    sidebarWidth: 400,
    animationDuration: 300,
    maxMessageHistory: 10
  }
}
```

### å¸¸é‡å®šä¹‰ (`src/config/constants.js`)

åŒ…å«åº”ç”¨å¸¸é‡ã€æ¶ˆæ¯ç±»å‹ã€HTTP çŠ¶æ€ç ç­‰ï¼š

```javascript
STORAGE_KEYS = {
  AI_CONFIG: 'aiConfig',
  MCP_SERVICES: 'mcpServices',
  CONVERSATIONS: 'conversations',
  DEV_MODE: 'devMode'
}

MESSAGE_ROLES = {
  USER: 'user',
  ASSISTANT: 'assistant',
  SYSTEM: 'system',
  TOOL: 'tool'
}
```

### é…ç½®ä¼˜å…ˆçº§

1. **ç”¨æˆ·é…ç½®** - é€šè¿‡è®¾ç½®é¡µé¢ä¿å­˜çš„é…ç½®ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
2. **é»˜è®¤é…ç½®** - `src/config/defaults.js` ä¸­å®šä¹‰çš„é»˜è®¤å€¼
3. **ç¡¬ç¼–ç é…ç½®** - ä»£ç ä¸­çš„å¤‡ç”¨å€¼ï¼ˆä¼˜å…ˆçº§æœ€ä½ï¼‰

### ä¿®æ”¹é»˜è®¤é…ç½®

#### ä¿®æ”¹ API é»˜è®¤åœ°å€

ç¼–è¾‘ `src/config/defaults.js`:

```javascript
DEFAULT_CONFIG = {
  api: {
    url: 'https://your-api-endpoint.com/v1',  // ä¿®æ”¹æ­¤å¤„
    // ...
  }
}
```

#### ä¿®æ”¹ MCP è¶…æ—¶æ—¶é—´

```javascript
DEFAULT_CONFIG = {
  mcp: {
    timeout: 60000,  // å¢åŠ åˆ° 60 ç§’
    // ...
  }
}
```

#### ä¿®æ”¹ UI è®¾ç½®

```javascript
DEFAULT_CONFIG = {
  ui: {
    sidebarWidth: 500,           // å¢åŠ ä¾§è¾¹æ å®½åº¦
    maxMessageHistory: 20,       // å¢åŠ å†å²æ¶ˆæ¯æ•°é‡
    // ...
  }
}
```

### å¼€å‘æ¨¡å¼é…ç½®

#### å¯ç”¨è°ƒè¯•æ—¥å¿—

åœ¨è®¾ç½®é¡µé¢å¯ç”¨**å¼€å‘æ¨¡å¼**ï¼Œæˆ–ç›´æ¥ä¿®æ”¹ `src/config/defaults.js`:

```javascript
DEV_CONFIG = {
  debug: true,              // å¯ç”¨è°ƒè¯•æ¨¡å¼
  logLevel: 'debug',        // è®¾ç½®æ—¥å¿—çº§åˆ«
  mockApi: false,           // æ˜¯å¦ä½¿ç”¨æ¨¡æ‹Ÿ API
  apiTimeout: 60000         // API è¶…æ—¶æ—¶é—´
}
```

#### æ—¥å¿—çº§åˆ«è¯´æ˜

- **debug** - æ˜¾ç¤ºæ‰€æœ‰æ—¥å¿—ï¼ˆæœ€è¯¦ç»†ï¼‰
- **info** - æ˜¾ç¤ºä¿¡æ¯ã€è­¦å‘Šå’Œé”™è¯¯
- **warn** - ä»…æ˜¾ç¤ºè­¦å‘Šå’Œé”™è¯¯
- **error** - ä»…æ˜¾ç¤ºé”™è¯¯ï¼ˆæœ€ç®€æ´ï¼‰

### å­˜å‚¨ç»“æ„

```javascript
chrome.storage.local = {
  // AI é…ç½®
  aiConfig: {
    apiKey: string,
    apiUrl: string,
    model: string,
    user: string
  },
  
  // MCP æœåŠ¡åˆ—è¡¨
  mcpServices: [
    {
      id: string,
      name: string,
      url: string,
      enabled: boolean,
      method: 'GET' | 'POST'
    }
  ],
  
  // å¯¹è¯å†å²
  conversations: [
    {
      id: string,
      title: string,
      messages: Array<Message>,
      conversationId: string,
      createdAt: string
    }
  ],
  
  // å¼€å‘æ¨¡å¼
  devMode: {
    enabled: boolean,
    logLevel: 'debug' | 'info' | 'warn' | 'error'
  }
}
```

## MCP æœåŠ¡

MCP (Model Context Protocol) æœåŠ¡ä¸ºå¯¹è¯æä¾›é¢å¤–çš„å·¥å…·å’Œä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚æœ¬æ‰©å±•æ”¯æŒæ ‡å‡†çš„ **FastMCP** åè®®ï¼ˆJSON-RPC 2.0 over SSEï¼‰ã€‚

### åè®®æ”¯æŒ

1. **FastMCP æ ‡å‡†åè®®**ï¼ˆæ¨èï¼‰
   - åŸºäº JSON-RPC 2.0
   - é€šè¿‡ SSE ä¼ è¾“
   - æ”¯æŒ `tools/list` æ–¹æ³•è·å–å·¥å…·åˆ—è¡¨

2. **å›é€€å…¼å®¹**
   - REST API: `GET {baseUrl}/tools`
   - ç®€å• SSE: è¿”å› JSON æ ¼å¼çš„å·¥å…·åˆ—è¡¨

### FastMCP æœåŠ¡ç¤ºä¾‹

ä½¿ç”¨ Python FastMCP åˆ›å»ºæœåŠ¡ï¼š

```python
from fastmcp import FastMCP

# åˆ›å»º MCP æœåŠ¡å™¨
mcp = FastMCP("My Tools")

@mcp.tool()
def search_web(query: str) -> str:
    """æœç´¢ç½‘ç»œå†…å®¹"""
    return f"æœç´¢ç»“æœ: {query}"

@mcp.tool()
def get_weather(city: str) -> str:
    """è·å–å¤©æ°”ä¿¡æ¯"""
    return f"{city} çš„å¤©æ°”: æ™´å¤©"

# å¯åŠ¨æœåŠ¡å™¨ï¼ˆé»˜è®¤ç«¯å£ 8000ï¼‰
if __name__ == "__main__":
    mcp.run(transport="sse")
```

å¯åŠ¨æœåŠ¡ï¼š
```bash
python your_mcp_server.py
```

åœ¨æ‰©å±•è®¾ç½®ä¸­é…ç½®ï¼š
- **æœåŠ¡åç§°**: My Tools
- **SSE ç«¯ç‚¹ URL**: `http://127.0.0.1:8000/sse`
- **è¯·æ±‚æ–¹æ³•**: GETï¼ˆFastMCP ä½¿ç”¨ GET å»ºç«‹ SSE è¿æ¥ï¼‰

### FastMCP åè®®æ ¼å¼

**è¿æ¥æ–¹å¼**: GET è¯·æ±‚åˆ° SSE ç«¯ç‚¹

**å“åº”** (SSE stream):
```
data: {"tools":[{"name":"search_web","description":"æœç´¢ç½‘ç»œå†…å®¹","inputSchema":{"type":"object","properties":{"query":{"type":"string"}}}}]}

```

æˆ– JSON-RPC 2.0 æ ¼å¼:
```
data: {"jsonrpc":"2.0","result":{"tools":[...]}}

```

### æœåŠ¡å™¨è¦æ±‚

- **CORS æ”¯æŒ**: å¿…é¡»å…è®¸æ¥è‡ª `chrome-extension://` çš„è¯·æ±‚
- **å“åº”å¤´**:
  - `Content-Type: text/event-stream`
  - `Cache-Control: no-cache`
  - `Access-Control-Allow-Origin: *`
  - `Access-Control-Allow-Methods: POST, OPTIONS`
  - `Access-Control-Allow-Headers: Content-Type`

## å¼€å‘æŒ‡å—

### å¼€å‘è€…é€‰é¡¹

åœ¨è®¾ç½®é¡µé¢å¯ç”¨**å¼€å‘æ¨¡å¼**å¯ä»¥ï¼š
- åœ¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- è®¾ç½®æ—¥å¿—çº§åˆ«ï¼ˆDebug / Info / Warn / Errorï¼‰
- å¸®åŠ©è°ƒè¯• MCP æœåŠ¡å’Œ API é—®é¢˜

### å¼€å‘å·¥ä½œæµ

```
1. ä¿®æ”¹é…ç½®
   ç¼–è¾‘ src/config/defaults.js
   
2. æ·»åŠ æ–°åŠŸèƒ½
   â”œâ”€ åˆ›å»ºæ–°æ¨¡å— (src/services/ æˆ– src/utils/)
   â”œâ”€ å¯¼å‡ºåŠŸèƒ½
   â””â”€ åœ¨åº”ç”¨å±‚å¯¼å…¥ä½¿ç”¨
   
3. è°ƒè¯•
   â”œâ”€ å¯ç”¨å¼€å‘æ¨¡å¼
   â”œâ”€ è®¾ç½®æ—¥å¿—çº§åˆ«
   â””â”€ æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º
   
4. æµ‹è¯•
   â”œâ”€ ä½¿ç”¨æµ‹è¯•æŒ‰é’®éªŒè¯
   â”œâ”€ æ£€æŸ¥æ—¥å¿—è¾“å‡º
   â””â”€ éªŒè¯åŠŸèƒ½æ­£å¸¸
```

### ä»£ç è§„èŒƒ

#### ES6 æ¨¡å—
æ‰€æœ‰æ–°æ¨¡å—ä½¿ç”¨ ES6 `import/export` è¯­æ³•ï¼š
```javascript
import { StorageManager } from './src/utils/storage.js';
import { logger } from './src/utils/logger.js';
```

#### å‘½åçº¦å®š
- **ç±»**: PascalCase (å¦‚ `AIChat`, `MCPClient`)
- **å‡½æ•°**: camelCase (å¦‚ `sendMessage`, `getTools`)
- **å¸¸é‡**: UPPER_SNAKE_CASE (å¦‚ `DEFAULT_CONFIG`, `MESSAGE_ROLES`)
- **æ–‡ä»¶**: kebab-case (å¦‚ `ai-api.js`, `tool-parser.js`)

#### æ—¥å¿—ä½¿ç”¨
```javascript
logger.debug('[Component] Debug message');   // è°ƒè¯•ä¿¡æ¯
logger.info('[Component] Info message');     // ä¸€èˆ¬ä¿¡æ¯
logger.warn('[Component] Warning message');  // è­¦å‘Š
logger.error('[Component] Error message');   // é”™è¯¯
```

### æ•…éšœæ’é™¤

#### API è¿æ¥å¤±è´¥

1. æ£€æŸ¥ API åœ°å€æ˜¯å¦æ­£ç¡®
2. éªŒè¯ API Key æ˜¯å¦æœ‰æ•ˆ
3. å¯ç”¨å¼€å‘æ¨¡å¼æŸ¥çœ‹è¯¦ç»†é”™è¯¯
4. æ£€æŸ¥ç½‘ç»œè¿æ¥

#### MCP æœåŠ¡æ— æ³•è¿æ¥

1. ç¡®è®¤æœåŠ¡ URL æ ¼å¼æ­£ç¡®ï¼ˆå¦‚ `http://127.0.0.1:8000/sse`ï¼‰
2. æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œ
3. éªŒè¯ CORS è®¾ç½®
4. å¯ç”¨å¼€å‘æ¨¡å¼æŸ¥çœ‹è¿æ¥æ—¥å¿—

#### é…ç½®æœªä¿å­˜

1. æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦å…è®¸æ‰©å±•è®¿é—®å­˜å‚¨
2. æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
3. å°è¯•é‡æ–°åŠ è½½æ‰©å±•
4. æ£€æŸ¥æ‰©å±•ä¸Šä¸‹æ–‡æ˜¯å¦æœ‰æ•ˆ

## é‡æ„è¯´æ˜

### é‡æ„ç›®æ ‡
1. âœ… å¿…è¦çš„é…ç½®é€šè¿‡é…ç½®æ–‡ä»¶å®ç°
2. âœ… ä»£ç æ›´æ•´æ´åˆç†ï¼Œåˆ é™¤å¤šä½™çš„å†—ä½™ä»£ç 
3. âœ… æ·»åŠ å¿…è¦çš„å¼€å‘æ¨¡å¼å‚æ•°

### ä¸»è¦æ”¹è¿›

#### æ¶æ„å‡çº§
- **åˆ†å±‚æ¶æ„**: é…ç½®å±‚ â†’ å·¥å…·å±‚ â†’ æœåŠ¡å±‚ â†’ åº”ç”¨å±‚
- **æ¨¡å—åŒ–**: æ‰€æœ‰åŠŸèƒ½æŒ‰èŒè´£åˆ†ç¦»
- **å¯å¤ç”¨**: å…±äº«çš„æœåŠ¡å’Œå·¥å…·ç±»
- **å¯æµ‹è¯•**: æ¯ä¸ªæ¨¡å—å¯ç‹¬ç«‹æµ‹è¯•

#### ä»£ç è´¨é‡
- **æ¶ˆé™¤é‡å¤**: MCP å®¢æˆ·ç«¯ä» 2 ä»½åˆå¹¶ä¸º 1 ä»½
- **ç»Ÿä¸€æ¥å£**: æ‰€æœ‰å­˜å‚¨æ“ä½œé€šè¿‡ `StorageManager`
- **ç±»å‹å®‰å…¨**: ä½¿ç”¨å¸¸é‡é¿å…é­”æ³•å­—ç¬¦ä¸²
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—

#### å¼€å‘ä½“éªŒ
- **å¼€å‘æ¨¡å¼**: å¯åœ¨è®¾ç½®ä¸­å¯ç”¨ï¼ŒæŸ¥çœ‹è¯¦ç»†æ—¥å¿—
- **é…ç½®é›†ä¸­**: ä¿®æ”¹é…ç½®æ›´ç®€å•
- **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„æ–‡æ¡£è¯´æ˜

### é‡æ„æˆæœ

- **ä»£ç è¡Œæ•°å‡å°‘**: ~45%
- **æ¨¡å—åŒ–ç¨‹åº¦**: ä»å•ä½“åˆ° 8 ä¸ªç‹¬ç«‹æ¨¡å—
- **å¯ç»´æŠ¤æ€§**: å¤§å¹…æå‡
- **å¼€å‘å·¥å…·**: å®Œå–„çš„æ—¥å¿—å’Œè°ƒè¯•åŠŸèƒ½

é¡¹ç›®ç°åœ¨å…·æœ‰æ¸…æ™°çš„æ¶æ„ã€å®Œå–„çš„é…ç½®ç³»ç»Ÿå’Œå¼ºå¤§çš„å¼€å‘å·¥å…·ï¼Œä¸ºæœªæ¥çš„åŠŸèƒ½æ‰©å±•æ‰“ä¸‹äº†åšå®çš„åŸºç¡€ï¼

## æ³¨æ„äº‹é¡¹

- API Key ä¿å­˜åœ¨æœ¬åœ°ï¼Œè¯·å¦¥å–„ä¿ç®¡
- å¯¹è¯å†å²å­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ä¸­
- MCP æœåŠ¡éœ€è¦æ”¯æŒ CORS
- é¦–æ¬¡ä½¿ç”¨éœ€è¦é…ç½® API

## è®¸å¯è¯

MIT License

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼
